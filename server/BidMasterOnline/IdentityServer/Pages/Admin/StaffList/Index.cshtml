@page
@using Microsoft.AspNetCore.Authorization
@model IdentityServer.Pages.Admin.StaffList.IndexModel
@attribute [Authorize(Roles = "Admin")]
@{
}

<h1>Staff List</h1>

<form method="get" class="mb-3">
    <input type="text" name="search" value="@Model.Search" class="form-control" placeholder="Search by username or email..." />
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th>
                <a asp-page="./StaffList" asp-route-search="@Model.Search" asp-route-sortColumn="Username" asp-route-sortDirection="@Model.GetSortDirection("Username")">
                    Username @(Model.GetSortIcon("Username"))
                </a>
            </th>
            <th>
                <a asp-page="./StaffList" asp-route-search="@Model.Search" asp-route-sortColumn="Email" asp-route-sortDirection="@Model.GetSortDirection("Email")">
                    Email @(Model.GetSortIcon("Email"))
                </a>
            </th>
            <th>
                <a asp-page="./StaffList" asp-route-search="@Model.Search" asp-route-sortColumn="FullName" asp-route-sortDirection="@Model.GetSortDirection("FullName")">
                    Full Name @(Model.GetSortIcon("FullName"))
                </a>
            </th>
            <th>
                <a asp-page="./StaffList" asp-route-search="@Model.Search" asp-route-sortColumn="DateOfBirth" asp-route-sortDirection="@Model.GetSortDirection("DateOfBirth")">
                    Date of Birth @(Model.GetSortIcon("DateOfBirth"))
                </a>
            </th>
            <th>
                <a asp-page="./StaffList" asp-route-search="@Model.Search" asp-route-sortColumn="CreatedAt" asp-route-sortDirection="@Model.GetSortDirection("CreatedAt")">
                    Joined on @(Model.GetSortIcon("CreatedAt"))
                </a>
            </th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var moderator in Model.Moderators)
        {
            <tr>
                <td>@moderator.Username</td>
                <td>@moderator.Email</td>
                <td>@moderator.FullName</td>
                <td>@moderator.DateOfBirth</td>
                <td>@moderator.CreatedAt</td>
                <td>
                    <form method="post" asp-page-handler="Delete" asp-route-id="@moderator.Id">
                        <button class="btn btn-danger btn-sm" type="submit">Delete</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<nav>
    <ul class="pagination">
        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                <a class="page-link"
                   asp-page="./StaffList"
                   asp-route-pageNumber="@i"
                   asp-route-search="@Model.Search"
                   asp-route-sortColumn="@Model.SortColumn"
                   asp-route-sortDirection="@Model.SortDirection">
                    @i
                </a>
            </li>
        }
    </ul>
</nav>